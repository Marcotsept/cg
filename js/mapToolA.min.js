function readFile(e){var t=new FileReader;t.readAsBinaryString(e.slice(0,3));t.onload=function(n){if(t.result=="MAP"){isMapFileConfirmed=true;$("#filename").html(e.name).removeClass("label-default").addClass("label-success");readBlob(e)}else{e=undefined;isMapFileConfirmed=false;$("#map_size").add("#map_content").html("");$("#filename").html("xxxx.dat").removeClass("label-success").addClass("label-default")}}}function readBlob(e){var t=new FileReader;var n=new FileReader;var r=e.slice(0,20);var i={};var s;var o=e.size;var u;var a=[];t.readAsArrayBuffer(r);t.onload=function(r){var a=new DataView(t.result);i.width=a.getUint16(12,true);i.height=a.getUint16(16,true);i.area=function(){return this.width*this.height};i.toString=function(){var e=searchTarget==3?"迷宮":"地圖";e+="大小 : "+this.width+"&times;"+this.height;return e};$("#map_size").html(i.toString());s=i.area()*4+20;u=e.slice(s,o);n.readAsArrayBuffer(u)};n.onload=function(e){var t=new DataView(n.result);var r;var s;a=[];for(var o=0;o<i.height;o++){for(var u=0;u<i.width;u++){s=(u+o*i.width)*2;r=t.getUint16(s,true)%256;if(r==searchTarget){a.push({east:u,south:o})}}}$("#map_content").html(function(){if(a.length!=0){var e='共找到<span class="badge">'+a.length+"</span>個";e+=searchTarget==3?"樓梯位置":"地圖出入口";e+="在：<br/>";$(a).each(function(t,n){e+='<span class="badge">'+(n.east+","+n.south).fontcolor("black")+"</span> "});return e}else{return searchTarget==3?"沒找到任何樓梯位置":"沒找到任何出入口位置"}}())}}var searchTarget=3;var isMapFileConfirmed=false;jQuery.event.props.push("dataTransfer");$(document).ready(function(){var e;$("#searchType").click(function(t){searchTarget=$(t.target).find(":radio").val();if(e!=undefined){if(isMapFileConfirmed)readBlob(e);else readFile(e)}});$("#drop").on("dragover",function(e){$(this).toggleClass("red");e.stopPropagation();e.preventDefault()});$("#drop").on("drop",function(t){t.stopPropagation();t.preventDefault();e=t.originalEvent.dataTransfer.files[0];isMapFileConfirmed=false;readFile(e)});$("#drop").hover(function(e){$(this).toggleClass("red")})})