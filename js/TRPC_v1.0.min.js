function initUI(){$("input[id^=attr_A]").spinner({max:10,min:0}).css("width","30px");$("#atk").spinner({max:1e4,min:0}).css("width","100px");$("#mnd").spinner({max:1e3,min:0}).css("width","100px");$("#matk").spinner({max:500,min:0}).css("width","100px");$("#lv").spinner({max:165,min:1}).css("width","100px");$("#weapon_p").buttonset();$("#weapon_m").buttonset();$("#attacker").buttonset();$("#attackType").buttonset();$("#critical").buttonset();$("#critical_s").buttonset();$("#calc_p").button().hide();$("#mag").hide();$("#kind_p").hide();$("#kind_m").hide();$("#skill_p").val(0);$("#skill_plv").val(1);$("#kind_A").val("H");$("#skill_m").val(0);$("#skill_mlv").val(1)}function initChart(){var e;$("#chart").highcharts({chart:{type:"line",borderWidth:2,borderColor:"#88a"},title:{text:""},xAxis:{title:{text:""},labels:{overflow:"justify"},min:0,gridLineWidth:1},yAxis:{title:{text:"傷害值",style:{fontSize:"12px",color:"#2D2",fontFamily:"Tahoma"}},min:0,minorGridLineWidth:0,gridLineWidth:1,alternateGridColor:null},tooltip:{crosshairs:true,shared:true},plotOptions:{line:{lineWidth:2,states:{hover:{lineWidth:3}},marker:{enabled:false},pointStart:0}}});e=$("#chart").highcharts();e.xAxis[0].addPlotLine({color:"rgba(128,0,0,0.5)",value:240,width:2,dashStyle:"Dash"});return e}function getAttackerParam(){p.atk=0;p.lv=parseInt($("#lv").val(),10);p.kind=$("#kind_A").val();p.attrs[0]=parseInt($("#attr_A1").val(),10);p.attrs[1]=parseInt($("#attr_A2").val(),10);p.attrs[2]=parseInt($("#attr_A3").val(),10);p.attrs[3]=parseInt($("#attr_A4").val(),10);if(p.atkType=="physic"){p.skill=parseInt($("#skill_p").val(),10);p.skill_lv=parseInt($("#skill_plv").val(),10);p.kindWeapon=$("#kind_p").val()}if(p.atkType=="magic"){p.matk=parseInt($("#matk").val(),10);p.kindWeapon=$("#kind_m").val();p.skill=parseInt($("#skill_m").val(),10);p.skill_lv=parseInt($("#skill_mlv").val(),10);p.atkNum=parseInt($("#atkNum").val(),10)}}function showM(e,t){var n,r=0,i,s;$("#monStatus").children().remove();for(r=0;r<e.length;r++){n=$("#monTemplate").clone(true).removeProp("id");n.data("monId",e[r]);i=Monster.generate(e[r],t,"max");s=Monster.generate(e[r],t,"min");n.find(".m_name").text(i.name);n.find(".m_lv").text(t);n.find(".m_kind").text(i.kn.ch+"系");n.find(".m_attr1").text("地 : "+i.attrs[0]);n.find(".m_attr2").text("水 : "+i.attrs[1]);n.find(".m_attr3").text("火 : "+i.attrs[2]);n.find(".m_attr4").text("風 : "+i.attrs[3]);n.find(".m_hp").text("血量 : "+s.hp+" ~ "+i.hp);n.find(".m_def").text("防禦 : "+s.def+" ~ "+i.def);n.find(".m_mnd").text("精神 : "+s.mnd+" ~ "+i.mnd);n.appendTo("#monStatus")}}var p,m,chart;$(function(){var e=$("#trp"),t=params.trp,n;p={lv:1,kind:"H",attrs:[0,0,0,0],atk:0,mnd:0,matk:0,skill:0,skill_plv:1,atkType:"physic",kindWeapon:"",hasKindWeapon:false,hasCritical:false};initUI();chart=initChart();$.each(t,function(t,n){e.append('<option value="'+n.id+'">'+n.name+"</option>")});e.val(0).css({width:"250px",color:"#2f2","border-color":"#cfc"}).change(function(e){var r=[],i=[];n=t[this.value];$.each(n.monId,function(e,t){m=Monster.generate(t,n.lv_low,"std");r.push(m);i.push(m.name)});$("#m_lv_span").show();$("#m_lv option").remove();for(var s=n.lv_low;s<=n.lv_high;s++){$("#m_lv").append('<option value="'+s+'">'+s+"</option>")}showM(n.monId,n.lv_low);chart.setTitle({text:n.name,style:{"font-size":"16px",color:"#a22"}},{color:"#080"},true);$("#monStatus").show()}).find("option").css("width","200px");$("#m_lv").change(function(e){showM(n.monId,this.value)});$("#calc_p").click(function(){var e=0,t=0,n=[],r=[];result={},xTitle="";getAttackerParam();while(chart.series.length!=0){chart.series[0].remove()}if(p.atkType=="physic"){for(e=0;e<=1500;e+=5){p.atk=e;result=HurtCalc.phyHurt(p,m);n.push([e,result.lowerHurt,result.upperHurt]);r.push([e,result.hurt])}xTitle="攻擊力"}if(p.atkType=="magic"){for(t=0;t<=800;t+=2){p.mnd=t;result=HurtCalc.magHurt(p,m);n.push([t,result.lowerHurt,result.upperHurt]);r.push([t,result.hurt])}xTitle="精神 , 魔攻(@"+p.matk+")"}hurtSeries={name:"對Lv"+m.lv+"級"+m.name+"平均傷害",type:"line",data:r,color:Highcharts.getOptions().colors[0],zIndex:1};rangeSeries={name:"對Lv"+m.lv+"級"+m.name+"的傷害值範圍",type:"arearange",data:n,linkedTo:":previous",color:Highcharts.getOptions().colors[0],fillOpacity:.3,lineWidth:0,zIndex:0};chart.yAxis[0].removePlotLine("mhp0");chart.yAxis[0].removePlotLine("mhp1");chart.yAxis[0].removePlotLine("mhp2");chart.xAxis[0].setTitle({text:xTitle});chart.yAxis[0].addPlotLine({color:"rgba(240,0,0,0.5)",value:m.hp/4,label:{text:"25% HP",textAlign:"left"},width:2,id:"mhp0",dashStyle:"Dash"});chart.yAxis[0].addPlotLine({color:"rgba(240,0,0,0.5)",value:m.hp/2,label:{text:"50% HP",textAlign:"left"},width:2,id:"mhp1",dashStyle:"Dash"});chart.yAxis[0].addPlotLine({color:"rgba(240,0,0,0.5)",value:m.hp,label:{text:"100% HP",textAlign:"left"},width:2,id:"mhp2",dashStyle:"Dash"});chart.addSeries(hurtSeries);chart.addSeries(rangeSeries);chart.redraw()});$("#skill_p").change(function(){var e=this.selectedIndex;p.skill=e;if(e>4)$("#skill_plv").show().val(1);else $("#skill_plv").hide()});$("#skill_m").change(function(){var e=this.selectedIndex,t=["earth","water","fire","wind"];p.skill=e;$(this).removeClass();if(e<12){$(this).addClass(t[e%4]);$("#shkArea").hide()}else{$("#atkNum").val(1);$("#shkArea").show();p.atkNum=1}});$("#skill_plv").change(function(){var e=this.selectedIndex;p.skill_lv=e});$("#kind_p").change(function(){var e=$(this).val();p.kindWeapon=e});$("#critical :radio").change(function(){p.hasCritical=this.value==1});$("#critical_s :radio").change(function(){if(p.skill==12)p.hasCritical=this.value==1});$("#attackType :radio").click(function(e){var t=this.value;e.preventDefault();if(t==1){p.atkType="physic";$("#phy").show();$("#mag").hide()}else{p.atkType="magic";$("#phy").hide();$("#mag").show()}});$("#weapon_p :radio").click(function(e){var t=this.value;e.preventDefault();if(t==1){p.hasKindWeapon=false;$("#kind_p").hide()}else{p.hasKindWeapon=true;$("#kind_p").show().val("H");p.kind_p="H"}});$("#weapon_m :radio").click(function(e){var t=this.value;e.preventDefault();if(t==1){p.hasKindWeapon=false;$("#kind_m").hide()}else{p.hasKindWeapon=true;$("#kind_m").show().val("H");p.kind_m="H"}});$("#monTemplate").click(function(e){m=Monster.generate($(this).data("monId"),$("#m_lv").val(),"std");$("#monStatus .panel").removeClass("selectedMonster");$(this).addClass("selectedMonster");if($(this).hasClass("selectedMonster"))$("#calc_p").show()})})